#
# Makefile for directory with subdirs to build.
#
# Last Mod Sat Apr 13 00:40:04 PDT 1991, by rich@cygint.cygnus.com
#

# $Id$

srcdir = .
destdir = /usr/local

#CC = gcc -b$(target) # -B$(srcdir)/../gas/Host-$(host)/Target-$(target)/
#CFLAGS = -g -nostdinc -nostdlib -I- -I/usr/local/lib/gcc/$(target)/1.92/include -I$(srcdir) -I$(srcdir)/../include -I$(OSINCLUDE)

# These are roughly topologically sorted in order to make porting more
# streamlined.

SUBDIRS =
NONSUBDIRS =
SUBDIRS_INCLUDE = machine-dep

RANLIB = ranlib
AR = ar
AR_FLAGS = cqv

#### host and target specific makefile fragments come in here.
###

subdir_do: $(SUBDIRS) $(TARGETDIRS)
	for i in $(SUBDIRS); \
	  do \
	    if (cd $(srcdir)/$$i`if [ -d $(srcdir)/$$i.$(target) ] ; \
		then echo .$(target) ; fi`$(subdir); \
		$(MAKE) \
		    "destdir=$(destdir)" \
		    "AR=$(AR)" \
		    "AR_FLAGS=$(AR_FLAGS)" \
		    "RANLIB=$(RANLIB)" $(DO)) ; \
	    then true ; \
	    else exit 1 ; \
	    fi ;\
	  done

all:
	$(MAKE) subdir_do DO=all

clean:
	rm -rf *.a TEMP errs core *.o *~ \#* TAGS *.E
	$(MAKE) subdir_do DO=clean

install: all
	$(MAKE) subdir_do DO=install

# When installing include files, be sure that machine-dependent
# files override machine-independent files.
# Might be better to check for collisions?  FIXME
install_crt:
	$(MAKE) SUBDIRS=machine-dep DO=install_crt

install_gnulib:
	$(MAKE) SUBDIRS=gnulib DO=install_gnulib

install_include:
	$(MAKE) SUBDIRS=$(SUBDIRS_INCLUDE) DO=install_include

install_lib: libc.a
	cp libc.a $(DESTDIR)/lib/libc.a

etags tags: TAGS

TAGS: FORCE
	etags `$(MAKE) ls`

ls:
	@echo Makefile
	@for i in $(SUBDIRS); \
	do \
		(cd $$i; \
			pwd=`pwd`; \
			wd=`basename $$pwd`; \
			for j in `$(MAKE) ls`; \
			do \
				echo $$wd/$$j; \
			done) \
	done

FORCE:

# with the gnu make, this is done automatically.

Makefile: $(srcdir)/Makefile.in $(srcdir)/configure
	(cd $(srcdir) ; \
		./configure +destdir=$(destdir) +norecurse \
		 `if [ "$(srcdir)" != "." ] ; then echo +f; fi` \
		+host=$(host) $(target))

#
# $Log$
# Revision 1.5  1991/04/13 07:40:41  rich
# Fixed an ordering bug.  Now everything is built, and then installed.
#
# Revision 1.4  1991/04/13  02:11:09  rich
# Config cut 3.  We now almost install a29k.
#
# Revision 1.3  1991/04/11  02:41:53  rich
# Cut 2 config.  Subdirs.
#
#
#

# end of Makefile.in
