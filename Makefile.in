#
# Makefile for directory with subdirs to build.
#   Copyright (C) 1990, 1991 Cygnus Support
#
# This file is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  */
#

srcdir = .

prefix = /usr/local

datadir = $(prefix)/lib
bindir = $(prefix)/bin
libdir = $(prefix)/lib
mandir = $(datadir)/man
man1dir = $(mandir)/man1
man2dir = $(mandir)/man2
man3dir = $(mandir)/man3
man4dir = $(mandir)/man4
man5dir = $(mandir)/man5
man6dir = $(mandir)/man6
man7dir = $(mandir)/man7
man8dir = $(mandir)/man8
man9dir = $(mandir)/man9
infodir = $(prefix)/info
includedir = $(prefix)/include
docdir = $(datadir)/doc

SHELL = /bin/sh

INSTALL = install -c
INSTALL_PROGRAM = $(INSTALL)
INSTALL_DATA = $(INSTALL)

AR = ar
AR_FLAGS = qv
RANLIB = ranlib

BISON = `if [ -d $(unsubdir)/../byacc ] ; \
	then echo \`pwd\`/$(unsubdir)/../byacc$(subdir)/byacc ; \
	else echo yacc ; fi`

MAKEINFO = makeinfo
FRESHMAKEINFO = `if [ -d $(unsubdir)/../texinfo/C ] ; \
	then echo \`pwd\`/$(unsubdir)/../texinfo/C$(subdir)/makeinfo ; \
	else echo echo ; fi`

#\`(cd $(srcdir)/bison ; \\`pwd\\`)\`
SUBDIRS = libiberty glob readline bfd gdb binutils ld gas gcc gnulib clib
OTHERS = 

ALL = all.normal

### for debugging
#GCCVERBOSE=-v


#### host and target specific makefile fragments come in here.
###

.PHONY: all info install-info clean-info

all:	$(ALL)

info: force
	$(MAKE) subdir_do DO=info "DODIRS=$(SUBDIRS)"

install-info: dir.info install-info-dirs force
	$(MAKE) subdir_do DO=install-info "DODIRS=$(SUBDIRS)"
#	$(MAKE) install-dir.info

# clib prms
all.normal: all-texinfo all-bison all-ld all-gnulib all-gdb all-make \
	all-cvs all-emacs all-ispell
#	$(MAKE) subdir_do DO=all "DODIRS=$(SUBDIRS) $(OTHERS)"

clean: clean-libiberty clean-texinfo clean-bfd clean-binutils clean-bison \
	clean-byacc clean-ld clean-gas clean-gcc clean-gnulib clean-readline \
	clean-glob clean-gdb clean-make clean-diff clean-grep clean-rcs \
	clean-cvs clean-emacs clean-ispell
	rm -rf *.a TEMP errs core *.o *~ \#* TAGS *.E

install: install-dirs install-libiberty install-texinfo install-binutils install-bison \
	install-byacc install-ld install-gas install-gnulib \
	install-readline install-glob install-gdb install-make install-cvs \
	install-emacs install-ispell


### libiberty
.PHONY: all-libiberty just-libiberty
all-libiberty: just-libiberty
just-libiberty: force
	[ -d $(unsubdir)/libiberty ] && (cd $(unsubdir)/libiberty$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-libiberty: force
	[ -d $(unsubdir)/libiberty ] && (cd $(unsubdir)/libiberty$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-libiberty: force
	[ -d $(unsubdir)/libiberty ] && (cd $(unsubdir)/libiberty$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### texinfo
.PHONY: all-texinfo just-texinfo
all-texinfo: just-texinfo
just-texinfo: just-libiberty force
	[ -d $(unsubdir)/texinfo ] && (cd $(unsubdir)/texinfo$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-texinfo: force
	[ -d $(unsubdir)/texinfo ] && (cd $(unsubdir)/texinfo$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-texinfo: force
	[ -d $(unsubdir)/texinfo ] && (cd $(unsubdir)/texinfo$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### bfd
.PHONY: all-bfd just-bfd
all-bfd: just-bfd
just-bfd: force
	[ -d $(unsubdir)/bfd ] && (cd $(unsubdir)/bfd$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-bfd: force
	[ -d $(unsubdir)/bfd ] && (cd $(unsubdir)/bfd$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-bfd: force
	[ -d $(unsubdir)/bfd ] && (cd $(unsubdir)/bfd$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### binutils
.PHONY: all-binutils just-binutils
all-binutils: just-binutils
just-binutils: just-libiberty just-bfd force
	[ -d $(unsubdir)/binutils ] && (cd $(unsubdir)/binutils$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-binutils: force
	[ -d $(unsubdir)/binutils ] && (cd $(unsubdir)/binutils$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-binutils: force
	[ -d $(unsubdir)/binutils ] && (cd $(unsubdir)/binutils$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### byacc
.PHONY: all-byacc just-byacc
all-byacc: just-byacc
just-byacc: force
	[ -d $(unsubdir)/byacc ] && (cd $(unsubdir)/byacc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-byacc: force
	[ -d $(unsubdir)/byacc ] && (cd $(unsubdir)/byacc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-byacc: force
	[ -d $(unsubdir)/byacc ] && (cd $(unsubdir)/byacc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### bison
.PHONY: all-bison just-bison
all-bison: just-bison
just-bison: just-libiberty force
	[ -d $(unsubdir)/bison ] && (cd $(unsubdir)/bison$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-bison: force
	[ -d $(unsubdir)/bison ] && (cd $(unsubdir)/bison$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-bison: force
	[ -d $(unsubdir)/bison ] && (cd $(unsubdir)/bison$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### gcc
.PHONY: all-gcc just-gcc
all-gcc: just-gcc
just-gcc: just-libiberty just-byacc force
	[ -d $(unsubdir)/gcc ] && (cd $(unsubdir)/gcc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-gcc: force
	[ -d $(unsubdir)/gcc ] && (cd $(unsubdir)/gcc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-gcc:
	[ -d $(unsubdir)/gcc ] && (cd $(unsubdir)/gcc$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### readline
.PHONY: all-readline just-readline
all-readline: just-readline
just-readline: force
	[ -d $(unsubdir)/readline ] && (cd $(unsubdir)/readline$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-readline: force
	[ -d $(unsubdir)/readline ] && (cd $(unsubdir)/readline$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-readline: force
	[ -d $(unsubdir)/readline ] && (cd $(unsubdir)/readline$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### glob
.PHONY: all-glob just-glob
all-glob: just-glob
just-glob: force
	[ -d $(unsubdir)/glob ] && (cd $(unsubdir)/glob$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-glob: force
	[ -d $(unsubdir)/glob ] && (cd $(unsubdir)/glob$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-glob: force
	[ -d $(unsubdir)/glob ] && (cd $(unsubdir)/glob$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### gas
.PHONY: all-gas just-gas
all-gas: just-gas
just-gas: just-libiberty just-bfd force
	[ -d $(unsubdir)/gas ] && (cd $(unsubdir)/gas$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-gas: force
	[ -d $(unsubdir)/gas ] && (cd $(unsubdir)/gas$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-gas: force
	[ -d $(unsubdir)/gas ] && (cd $(unsubdir)/gas$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### ld
.PHONY: all-ld just-ld
all-ld: just-ld
just-ld: just-libiberty just-bfd just-byacc force
	[ -d $(unsubdir)/ld ] && (cd $(unsubdir)/ld$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-ld: force
	[ -d $(unsubdir)/ld ] && (cd $(unsubdir)/ld$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-ld: force
	[ -d $(unsubdir)/ld ] && (cd $(unsubdir)/ld$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### gnulib
.PHONY: all-gnulib just-gnulib
all-gnulib: just-gnulib
just-gnulib: all-gcc all-gas all-binutils force
	[ -d $(unsubdir)/gnulib ] && (cd $(unsubdir)/gnulib$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-gnulib: force
	[ -d $(unsubdir)/gnulib ] && (cd $(unsubdir)/gnulib$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-gnulib: force
	[ -d $(unsubdir)/gnulib ] && (cd $(unsubdir)/gnulib$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### gdb
.PHONY: all-gdb just-gdb
all-gdb: just-gdb
just-gdb: just-bfd just-libiberty just-readline just-glob force
	[ -d $(unsubdir)/gdb ] && (cd $(unsubdir)/gdb$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-gdb: force
	[ -d $(unsubdir)/gdb ] && (cd $(unsubdir)/gdb$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-gdb: force
	[ -d $(unsubdir)/gdb ] && (cd $(unsubdir)/gdb$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### make
.PHONY: all-make just-make
all-make: just-make
just-make: all-libiberty force
	[ -d $(unsubdir)/make ] && (cd $(unsubdir)/make$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-make: force
	[ -d $(unsubdir)/make ] && (cd $(unsubdir)/make$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-make: force
	[ -d $(unsubdir)/make ] && (cd $(unsubdir)/make$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### diff
.PHONY: all-diff just-diff
all-diff: just-diff
just-diff: force
	[ -d $(unsubdir)/diff ] && (cd $(unsubdir)/diff$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-diff: force
	[ -d $(unsubdir)/diff ] && (cd $(unsubdir)/diff$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-diff: force
	[ -d $(unsubdir)/diff ] && (cd $(unsubdir)/diff/$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### grep
.PHONY: all-grep just-grep
all-grep: just-grep
just-grep: force
	[ -d $(unsubdir)/grep ] && (cd $(unsubdir)/grep$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-grep: force
	[ -d $(unsubdir)/grep ] && (cd $(unsubdir)/grep$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-grep: force
	[ -d $(unsubdir)/grep ] && (cd $(unsubdir)/grep$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### rcs
.PHONY: all-rcs just-rcs
all-rcs: just-rcs
just-rcs: just-diff just-grep force
	[ -d $(unsubdir)/rcs ] && (cd $(unsubdir)/rcs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-rcs: force
	[ -d $(unsubdir)/rcs ] && (cd $(unsubdir)/rcs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-rcs: install-grep install-diff force
	[ -d $(unsubdir)/rcs ] && (cd $(unsubdir)/rcs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### gdbm
.PHONY: all-gdbm just-gdbm
all-gdbm: just-gdbm
just-gdbm: force
	[ -d $(unsubdir)/gdbm ] && (cd $(unsubdir)/gdbm$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-gdbm: force
	[ -d $(unsubdir)/gdbm ] && (cd $(unsubdir)/gdbm$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-gdbm: force
	[ -d $(unsubdir)/gdbm ] && (cd $(unsubdir)/gdbm$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### cvs
.PHONY: all-cvs just-cvs
all-cvs: just-cvs just-rcs just-grep just-diff
just-cvs: just-gdbm force
	[ -d $(unsubdir)/cvs ] && (cd $(unsubdir)/cvs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-cvs: force
	[ -d $(unsubdir)/cvs ] && (cd $(unsubdir)/cvs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-cvs: install-rcs install-gdbm force
	[ -d $(unsubdir)/cvs ] && (cd $(unsubdir)/cvs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### emacs
.PHONY: all-emacs just-emacs
all-emacs: just-emacs
just-emacs: force
	[ -d $(unsubdir)/emacs ] && (cd $(unsubdir)/emacs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-emacs: force
	[ -d $(unsubdir)/emacs ] && (cd $(unsubdir)/emacs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-emacs: install-rcs install-gdbm force
	[ -d $(unsubdir)/emacs ] && (cd $(unsubdir)/emacs$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### ispell
.PHONY: all-ispell just-ispell
all-ispell: just-ispell
just-ispell: all-emacs force
	[ -d $(unsubdir)/ispell ] && (cd $(unsubdir)/ispell$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			all)

clean-ispell: force
	[ -d $(unsubdir)/ispell ] && (cd $(unsubdir)/ispell$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			clean)

install-ispell: install-rcs install-gdbm force
	[ -d $(unsubdir)/ispell ] && (cd $(unsubdir)/ispell$(subdir); \
		$(MAKE) \
			"against=$(against)" \
			"AR=$(AR)" \
			"AR_FLAGS=$(AR_FLAGS)" \
			"CC=$(CC)" \
			"RANLIB=$(RANLIB)" \
			"LOADLIBES=$(LOADLIBES)" \
			"LDFLAGS=$(LDFLAGS)" \
			"BISON=$(BISON)" \
			"MAKEINFO=$(MAKEINFO)" \
			install)

### other supporting targets
# this is a bad hack.
all.xclib:	all.normal
	if [ -d clib ] ; then \
		(cd clib ; $(MAKE)) ; \
	fi

subdir_do: force
	for i in $(DODIRS); do \
		if [ -f $(unsubdir)/$$i/localenv ] ; then \
			if (cd $(unsubdir)/$$i$(subdir); \
				$(MAKE) \
					"against=$(against)" \
					"BISON=$(BISON)" \
					"MAKEINFO=$(MAKEINFO)" \
					$(DO)) ; then true ; \
				else exit 1 ; fi ; \
		else if [ -d $(unsubdir)/$$i ] ; then \
			if (cd $(unsubdir)/$$i$(subdir); \
				$(MAKE) \
					"against=$(against)" \
					"AR=$(AR)" \
					"AR_FLAGS=$(AR_FLAGS)" \
					"CC=$(CC)" \
					"RANLIB=$(RANLIB)" \
					"LOADLIBES=$(LOADLIBES)" \
					"LDFLAGS=$(LDFLAGS)" \
					"BISON=$(BISON)" \
					"MAKEINFO=$(MAKEINFO)" \
					$(DO)) ; then true ; \
			else exit 1 ; fi ; \
		else true ; fi ; \
	fi ; \
	done

bootstrap:
	$(MAKE) all info
	$(MAKE) stage1
	$(MAKE) pass "stagepass=stage1"
	$(MAKE) stage2
	$(MAKE) pass "stagepass=stage2"
	$(MAKE) comparison

bootstrap2:
	$(MAKE) pass "stagepass=stage1"
	$(MAKE) stage2
	$(MAKE) pass "stagepass=stage2"
	$(MAKE) comparison

bootstrap3:
	$(MAKE) pass "stagepass=stage2"
	$(MAKE) comparison

pass:
	cp $(srcdir)/gcc/gstdarg.h $(unsubdir)/gas$(subdir)/stdarg.h
	$(MAKE) subdir_do "DO=all info" "DODIRS=$(SUBDIRS)" \
		"CC=`pwd`/$(unsubdir)/gcc$(subdir)/$(stagepass)/gcc \
		-O $(GCCVERBOSE) -I`pwd`/$(unsubdir)/gcc$(subdir)/include \
		-B`pwd`/$(unsubdir)/gcc$(subdir)/$(stagepass)/ \
		-B`pwd`/$(unsubdir)/gas$(subdir)/$(stagepass)/ \
		-B`pwd`/$(unsubdir)/ld$(subdir)/$(stagepass)/" \
		"AR=`pwd`/$(unsubdir)/binutils$(subdir)/$(stagepass)/ar" \
		"LD=`pwd`/$(unsubdir)/gcc$(subdir)/$(stagepass)/gcc $(GCCVERBOSE)" \
		"RANLIB=`pwd`/$(unsubdir)/binutils$(subdir)/$(stagepass)/ranlib" \
		"LOADLIBES=`pwd`/$(unsubdir)/gnulib$(subdir)/$(stagepass)/gnulib.a /lib/libc.a" \
		"LDFLAGS=-nostdlib /lib/crt0.o \
		-L`pwd`/$(unsubdir)/gnulib$(subdir)/$(stagepass)/ \
		-B`pwd`/$(unsubdir)/ld$(subdir)/$(stagepass)/"


stage1:
	$(MAKE) subdir_do DO=stage1 "DODIRS=$(SUBDIRS)"

stage2:
	$(MAKE) subdir_do DO=stage2 "DODIRS=$(SUBDIRS)"

stage3:
	$(MAKE) subdir_do DO=stage3 "DODIRS=$(SUBDIRS)"

stage4:
	$(MAKE) subdir_do DO=stage4 "DODIRS=$(SUBDIRS)"

against=stage2

comparison:; $(MAKE) subdir_do DO=comparison against=$(against) "DODIRS=$(SUBDIRS)"

de-stage1:; $(MAKE) subdir_do DO=de-stage1 "DODIRS=$(SUBDIRS)"
de-stage2:; $(MAKE) subdir_do DO=de-stage2 "DODIRS=$(SUBDIRS)"
de-stage3:; $(MAKE) subdir_do DO=de-stage3 "DODIRS=$(SUBDIRS)"
de-stage4:; $(MAKE) subdir_do DO=de-stage4 "DODIRS=$(SUBDIRS)"

# The "else true" stuff is for Ultrix; the shell returns the exit code
# of the "if" command, if no commands are run in the "then" or "else" part,
# causing Make to quit.

MAKEDIRS= \
	$(prefix) \
	$(bindir) \
	$(libdir) \
	$(includedir) \
	$(datadir) \
	$(docdir) \
	$(mandir) \
	$(man1dir) \
	$(man5dir)

#	$(man2dir) \
#	$(man3dir) \
#	$(man4dir) \
#	$(man6dir) \
#	$(man7dir) \
#	$(man8dir)

install-dirs: force
	for i in $(MAKEDIRS) ; do \
		echo Making $$i... ; \
		if [ -d $$i ] ; then true ; else mkdir $$i || exit 1 ; fi ; \
	done

MAKEINFODIRS= \
	$(prefix) \
	$(infodir)

install-info-dirs: force
	for i in $(MAKEINFODIRS) ; do \
		echo Making $$i... ; \
		if [ -d $$i ] ; then true ; else mkdir $$i ; fi ; \
	done

install-dir.info-in-place: force
	rdir=`cd $(srcdir)/texinfo ; pwd` \
	&& cd $(infodir) \
	&& ($${rdir}/gen-info-dir `pwd`) > dir

dir.info: force
#	$(srcdir)/texinfo/gen-info-dir . > dir.info.new
#	mv -f dir.info.new dir.info

etags tags: TAGS

TAGS: FORCE
	etags `$(MAKE) ls`

ls:
	@echo Makefile
	@for i in $(SUBDIRS); \
	do \
		(cd $$i; \
			pwd=`pwd`; \
			wd=`basename $$pwd`; \
			for j in `$(MAKE) ls`; \
			do \
				echo $$wd/$$j; \
			done) \
	done

force:

# with the gnu make, this is done automatically.

Makefile: $(srcdir)/Makefile.in $(host_makefile_frag) $(target_makefile_frag)
	$(SHELL) ./config.status

#
# Build GDB distributions that contain BFD, Include, Libiberty, Readline, etc

DEVO_SUPPORT= README DOC.configure Makefile.in configure configure.in \
	config.sub config
GDB_SUPPORT_DIRS= bfd include libiberty readline glob
GDB_SUPPORT_FILES= $(GDB_SUPPORT_DIRS) texinfo/fsf/texinfo.tex

setup-dirs: force_update
	./configure sun4
	make clean
	./configure -rm sun4
	chmod og=u `find $(DEVO_SUPPORT) $(GDB_SUPPORT_FILES) -print`

bfd.ilrt.tar.Z: setup-dirs
	rm -f bfd.ilrt.tar.Z
	tar cf - $(DEVO_SUPPORT) $(GDB_SUPPORT_FILES) \
		| compress -v >bfd.ilrt.tar.Z

gdb.tar.Z: setup-dirs
	(cd gdb; $(MAKE) -f Makefile.in make-proto-gdb.dir)
	$(MAKE) $(MFLAGS) -f Makefile.in make-gdb.tar.Z

make-gdb.tar.Z: $(DEVO_SUPPORT) $(GDB_SUPPORT_DIRS) gdb texinfo/fsf/texinfo.tex
	rm -rf proto-toplev; mkdir proto-toplev
	ln -s ../gdb/proto-gdb.dir proto-toplev/gdb
	(cd proto-toplev; for i in $(DEVO_SUPPORT) $(GDB_SUPPORT_DIRS); do \
		ln -s ../$$i . ; \
	done)
	# Take out texinfo from configurable dirs
	rm proto-toplev/configure.in
	sed '/^configdirs=/s/texinfo //' <configure.in >proto-toplev/configure.in
	# Take out glob from buildable dirs
	rm proto-toplev/Makefile.in
	sed '/^SUBDIRS =/s/glob //' <Makefile.in >proto-toplev/Makefile.in
	mkdir proto-toplev/texinfo
	mkdir proto-toplev/texinfo/fsf
	ln -s ../../../texinfo/fsf/texinfo.tex proto-toplev/texinfo/fsf/
	chmod og=u `find proto-toplev -print`
	(VER=`sed <gdb/Makefile.in -n 's/VERSION = //p'`; \
		echo "==> Making gdb-$$VER.tar.Z"; \
		ln -s proto-toplev gdb-$$VER; \
		tar cfh - gdb-$$VER \
		| compress -v >gdb-$$VER.tar.Z)

force_update:

nothing:

# end of Makefile.in
