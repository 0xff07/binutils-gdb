From 8fab8e7e7260ef27a1025585e7120d404dc86811 Mon Sep 17 00:00:00 2001
From: "H.J. Lu" <hjl.tools@gmail.com>
Date: Fri, 17 Aug 2018 05:18:39 -0700
Subject: [PATCH 4/5] gold: Pass -Wa,-mx86-used-note=no to COMPILE/CXXCOMPILE

Work around --incremental-update problems with GNU properties.

	PR gold/23539
	* testsuite/Makefile.am (COMPILE): Add -Wa,-mx86-used-note=no.
	(CXXCOMPILE): Likewise.
---
 gold/testsuite/Makefile.am | 2 ++
 gold/testsuite/Makefile.in | 6 ++++--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/gold/testsuite/Makefile.am b/gold/testsuite/Makefile.am
index c9f7f15eb1..78c14bba52 100644
--- a/gold/testsuite/Makefile.am
+++ b/gold/testsuite/Makefile.am
@@ -56,6 +56,8 @@ COMPILE = `echo $(COMPILE1) | sed $(editcc) $(editcc1)`
 LINK = `echo $(LINK1) | sed $(editcc) $(editcc1)`
 CXXCOMPILE = `echo $(CXXCOMPILE1) | sed $(editcc) $(editcc1)`
 CXXLINK = `echo $(CXXLINK1) | sed $(editcc) $(editcc1)`
+COMPILE += -Wa,-mx86-used-note=no
+CXXCOMPILE += -Wa,-mx86-used-note=no
 
 # Strip out -static-libgcc and -static-libstdc++ options, for tests
 # that must have these libraries linked dynamically.  The -shared-libgcc
diff --git a/gold/testsuite/Makefile.in b/gold/testsuite/Makefile.in
index a6d485c9cd..dac9094ee3 100644
--- a/gold/testsuite/Makefile.in
+++ b/gold/testsuite/Makefile.in
@@ -2763,9 +2763,11 @@ editcc = -e 's/\([^ ]*\)\(.*\)/\1 -Bgcctestdir\/\2/'
 editcc1 = -e 's/-Wp,-D_FORTIFY_SOURCE=[0-9][0-9]*//'
 CCLD = `echo $(CC) | sed $(editcc)`
 CXXLD = `echo $(CXX) | sed $(editcc)`
-COMPILE = `echo $(COMPILE1) | sed $(editcc) $(editcc1)`
+COMPILE = `echo $(COMPILE1) | sed $(editcc) $(editcc1)` \
+	-Wa,-mx86-used-note=no
 LINK = `echo $(LINK1) | sed $(editcc) $(editcc1)`
-CXXCOMPILE = `echo $(CXXCOMPILE1) | sed $(editcc) $(editcc1)`
+CXXCOMPILE = `echo $(CXXCOMPILE1) | sed $(editcc) $(editcc1)` \
+	-Wa,-mx86-used-note=no
 CXXLINK = `echo $(CXXLINK1) | sed $(editcc) $(editcc1)`
 
 # Strip out -static-libgcc and -static-libstdc++ options, for tests
-- 
2.19.1

