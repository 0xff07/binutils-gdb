#	@(#)Makefile	5.17 (Berkeley) 5/11/90

srcdir 	= .

prefix 	= /usr/local

program_prefix 	=
exec_prefix 	= $(prefix)
bindir 	= $(exec_prefix)/bin
libdir 	= $(exec_prefix)/lib
tooldir = $(libdir)
mandir 	= $(prefix)/man
man1dir = $(mandir)/man1

datadir = $(prefix)/lib

INSTALL 	= install -c
INSTALL_PROGRAM = $(INSTALL)
INSTALL_DATA 	= $(INSTALL)

#### host and target dependent Makefile fragments come in here.
###

PROG=	gprof
SRCS=	gprof.c arcs.c dfn.c lookup.c ${MACHINE}.c hertz.c \
	printgprof.c printlist.c
LIBS = ../bfd/libbfd.a ../libiberty/libiberty.a

OBJS=	blurbs.o gprof.o arcs.o dfn.o lookup.o $(MACHINE).o hertz.o \
	printgprof.o printlist.o

CFLAGS=	
.c.o:
	$(CC) -c $(CFLAGS) -I$(srcdir) -I$(srcdir)/../include -DMACHINE_H=\"$(MACHINE).h\" $(TCFLAGS) $(HCFLAGS) $<

all:	$(PROG)

.PHONY: check info install-info
check:
info:
install-info:

install: all
	$(INSTALL_DATA) $(srcdir)/gprof.1 $(man1dir)/gprof.1
	$(INSTALL_PROGRAM) $(PROG) $(bindir)

$(PROG):	$(OBJS)
	$(CC) $(CFLAGS) $(OBJS) -o $(PROG) $(LIBS)

# Make blurbs.c from gprof.callg and gprof.flat
blurbs.c: $(srcdir)/gprof.callg $(srcdir)/gprof.flat $(srcdir)/make-c-prog.awk
	awk -f $(srcdir)/make-c-prog.awk > ./blurbs.c \
		FUNCTION=flat_blurb  $(srcdir)/gprof.flat \
		FUNCTION=callg_blurb $(srcdir)/gprof.callg \

clean:
	-rm -f $(OBJS) core gprof nohup.out

Makefile : Makefile.in
	sh config.status


# These get around a bug in Sun Make in SunOS 4.1.1 and Solaris 2
gprof.o: gprof.c
arcs.o: arcs.c
dfn.o: dfn.c
lookup.o: lookup.c
$(MACHINE).o: $(MACHINE).c
hertz.o: hertz.c
printgprof.o: printgprof.c
printlist.o: printlist.c
blurbs.o: blurbs.c
