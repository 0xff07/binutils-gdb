#    Makefile template for Configure for the D10v sim library.
#    Copyright (C) 1996 Free Software Foundation, Inc.
#    Written by Cygnus Support.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

default: all

VPATH = @srcdir@
srcdir = @srcdir@
srcroot = $(srcdir)/../..

prefix = @prefix@
exec_prefix = @exec_prefix@

host_alias = @host_alias@
target_alias = @target_alias@
program_transform_name = @program_transform_name@
bindir = @bindir@

libdir = @libdir@
tooldir = $(libdir)/$(target_alias)

datadir = @datadir@
mandir = @mandir@
man1dir = $(mandir)/man1
man2dir = $(mandir)/man2
man3dir = $(mandir)/man3
man4dir = $(mandir)/man4
man5dir = $(mandir)/man5
man6dir = $(mandir)/man6
man7dir = $(mandir)/man7
man8dir = $(mandir)/man8
man9dir = $(mandir)/man9
infodir = @infodir@
includedir = @includedir@

SHELL = /bin/sh

INSTALL = $(srcroot)/install.sh -c
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_XFORM = $(INSTALL) -t='$(program_transform_name)'
INSTALL_XFORM1= $(INSTALL_XFORM) -b=.1

AR = @AR@
AR_FLAGS = rc
CC = @CC@
CC_FOR_BUILD = @CC_FOR_BUILD@
CFLAGS = @CFLAGS@
SIM_CFLAGS = @sim_cflags@
DEBUG_CFLAGS = @sim_debug@
CONFIG_CFLAGS = @DEFS@ $(SIM_CFLAGS) $(DEBUG_CFLAGS) $(HDEFINES) $(TDEFINES) $(CSEARCH) $(CSWITCHES) -DINSIDE_SIMULATOR
BUILD_CFLAGS = -g -O $(CSEARCH)
MAKEINFO = makeinfo
RANLIB = @RANLIB@

HDEFINES = @HDEFINES@
TDEFINES =

.NOEXPORT:
MAKEOVERRIDES=

#X=xstuff.o
#X_LIB=-lX11
X=
X_LIB=
MATH_LIB=


INCLUDE = d10v_sim.h $(srcdir)/../../gdb/callback.h
INCDIR = $(srcdir)/../../include 
CSEARCH = -I. -I$(srcdir)  -I../../include  \
  -I../../bfd -I$(INCDIR) -I$(srcdir)/../../bfd -I$(srcdir)/../../gdb -I$(srcdir)/../../newlib/libc/sys/d10v \
  -I$(srcdir)/../../opcodes
DEP = mkdep

LIBIBERTY_LIB	= ../../libiberty/libiberty.a
BFD_LIB		= ../../bfd/libbfd.a

all: run libsim.a

run: interp.o $(X) run.o table.o callback.o simops.o
	$(CC) $(CFLAGS) $(CONFIG_CFLAGS) -o run $(X) interp.o table.o callback.o simops.o run.o \
		$(BFD_LIB) $(LIBIBERTY_LIB) $(X_LIB) $(MATH_LIB)

interp.o:interp.c table.c $(INCLUDE)
run.o: $(srcdir)/../common/run.c $(INCLUDE)
	$(CC) -c $(CFLAGS) $(CONFIG_CFLAGS) $<

simops.o: simops.c $(INCLUDE)
callback.o: $(srcdir)/../../gdb/callback.c $(INCLUDE)
	$(CC) -c $(CFLAGS) $(CONFIG_CFLAGS) $<

libsim.a:interp.o table.o simops.o
	$(AR) $(ARFLAGS) libsim.a interp.o table.o simops.o
	$(RANLIB) libsim.a

simops.h: gencode
	./gencode -h >$@

table.c: gencode simops.h
	./gencode >$@

gencode.o: gencode.c $(INCLUDE)
	$(CC_FOR_BUILD) $(BUILD_CFLAGS) -c $(srcdir)/gencode.c

d10v-opc.o: $(srcdir)/../../opcodes/d10v-opc.c
	$(CC_FOR_BUILD) $(BUILD_CFLAGS) -c $(srcdir)/../../opcodes/d10v-opc.c

gencode: gencode.o d10v-opc.o
	$(CC_FOR_BUILD) $(BUILD_CFLAGS) -o gencode gencode.o d10v-opc.o $(BUILD_LIB)

.c.o:
	$(CC) -c $(CFLAGS) $(CONFIG_CFLAGS) $<

check:

info:
clean-info:
install-info:

tags etags: TAGS

TAGS: force
	etags $(INCDIR)/*.h $(srcdir)/*.h $(srcdir)/*.c

clean:
	rm -f *.[oa] *~ core *.E *.p *.ip aout-params.h gen-aout
	rm -f run table.c simops.h gencode libsim.a

distclean mostlyclean maintainer-clean realclean: clean
	rm -f TAGS
	rm -f Makefile config.cache config.log config.status

# Dummy target to force execution of dependent targets.
#
force:

# Copy the files into directories where they will be run.
install:
	$(INSTALL_XFORM) run $(bindir)/run

install-man: run.1
	$(INSTALL_XFORM1) $(srcdir)/run.1 $(man1dir)/run.1

Makefile: Makefile.in config.status
	$(SHELL) ./config.status

config.status: configure
	$(SHELL) ./config.status --recheck

dep: $(CFILES)
	mkdep $(CFLAGS) $?

# What appears below is generated by a hacked mkdep using gcc -MM.

# DO NOT DELETE THIS LINE -- mkdep uses it.
# DO NOT PUT ANYTHING AFTER THIS LINE, IT WILL GO AWAY.


# IF YOU PUT ANYTHING HERE IT WILL GO AWAY
