#    Makefile template for Configure for the MIPS simulator.
#    Written by Cygnus Support.

## COMMON_PRE_CONFIG_FRAG

srcdir=@srcdir@
srcroot=$(srcdir)/../../

SIM_OBJS = interp.o \
	sim-load.o \
	sim-utils.o \
	sim-hload.o \
	sim-io.o \
	sim-config.o \
	sim-endian.o \
	sim-engine.o \
	sim-stop.o \
	sim-resume.o \
	sim-reason.o \
	sim-events.o \
	sim-module.o \
	sim-trace.o \
	sim-options.o \
	sim-core.o \
	sim-watch.o

# List of flags to always pass to $(CC).
SIM_SUBTARGET=@SIM_SUBTARGET@

# FIXME: Hack to find syscall.h?  Better support for syscall.h
# is in progress.
SIM_EXTRA_CFLAGS = \
	$(SIM_SUBTARGET) \
	-I$(srcdir)/../../newlib/libc/sys/idt

SIM_EXTRA_CLEAN = clean-extra

SIM_EXTRA_ALL = tmp.igen

# List of main object files for `run'.
SIM_RUN_OBJS = nrun.o



## COMMON_POST_CONFIG_FRAG

interp.o: $(srcdir)/interp.c engine.c config.h sim-main.h

engine.c: gencode
	./gencode @SIMCONF@ > tmp-engine
	mv tmp-engine engine.c
tmp.igen: gencode
	./gencode --igen @SIMCONF@ > tmp-igen
	mv tmp-igen tmp.igen

gencode: gencode.o getopt.o getopt1.o
	$(CC_FOR_BUILD) -o $@ gencode.o getopt.o getopt1.o

gencode.o: $(srcdir)/gencode.c
	$(CC_FOR_BUILD) -c -g -I${srcroot}/include $(srcdir)/gencode.c

getopt.o: $(srcdir)/../../libiberty/getopt.c
	$(CC_FOR_BUILD) -c -g -I${srcroot}/include $(srcdir)/../../libiberty/getopt.c
getopt1.o: $(srcdir)/../../libiberty/getopt1.c
	$(CC_FOR_BUILD) -c -g -I${srcroot}/include $(srcdir)/../../libiberty/getopt1.c

clean-extra:
	rm -f gencode engine.c tmp.igen
